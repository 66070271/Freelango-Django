{% extends "layout.html" %}
{% load static %}

{% block title %}All Users â€” Freelango{% endblock %}

{% block content %}
{% include 'navbar.html' %}

<main class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 py-24 px-6 flex justify-center">
  <div class="max-w-6xl w-full bg-white border border-gray-200 rounded-2xl shadow-md p-10">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-10">
      <h1 class="text-3xl font-bold text-gray-900">All Users</h1>
      <p class="text-gray-500 text-sm">Showing {{ users|length }} users</p>
    </div>

    <!-- Search Bar -->
    <form method="GET" class="mb-8 flex justify-end">
      <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Search user..."
        class="rounded-l-lg border border-gray-300 px-4 py-2 text-gray-800 w-64 focus:ring-2 focus:ring-indigo-500 outline-none">
      <button type="submit"
        class="rounded-r-lg bg-indigo-600 text-white px-4 py-2 font-medium hover:bg-indigo-700 transition">
        Search
      </button>
    </form>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-indigo-100 text-gray-800 text-sm uppercase tracking-wider">
            <th class="py-3 px-4 text-left rounded-tl-xl">#</th>
            <th class="py-3 px-4 text-left">Name</th>
            <th class="py-3 px-4 text-left">Username</th>
            <th class="py-3 px-4 text-left">Email</th>
            <th class="py-3 px-4 text-left">Role</th>
            <th class="py-3 px-4 text-center rounded-tr-xl">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for user in users %}
          <tr class="border-b hover:bg-indigo-50 transition">
            <td class="py-3 px-4 text-gray-600">{{ forloop.counter }}</td>
            <td class="py-3 px-4 font-medium text-gray-900">{{ user.first_name }} {{ user.last_name }}</td>
            <td class="py-3 px-4 text-gray-700">{{ user.username }}</td>
            <td class="py-3 px-4 text-gray-700">{{ user.email }}</td>

            <!-- ROLE -->
            <td class="py-3 px-4">
              {% if user.groups.all %}
                {% if user.groups.first.name == "Admin" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-700 font-semibold">Admin</span>
                {% elif user.groups.first.name == "Freelancer" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-indigo-100 text-indigo-700 font-semibold">Freelancer</span>
                {% elif user.groups.first.name == "Client" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Client</span>
                {% else %}
                  <span class="px-3 py-1 text-xs rounded-full bg-gray-100 text-gray-600 font-semibold">Super</span>
                {% endif %}
              {% else %}
                <span class="px-3 py-1 text-xs rounded-full bg-gray-100 text-gray-600 font-semibold">Super</span>
              {% endif %}
            </td>

            <!-- ACTION -->
            <td class="py-3 px-4 text-center flex justify-center gap-3">

              <!-- View -->
               {% if user.groups.first.name == "Client" or user.groups.first.name == "Freelancer" %}
              <a href="{% url 'profile_view' user.id %}"
                class="inline-block text-sm px-4 py-1.5 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-medium transition">
                View
              </a>
              {% endif %}

              <!-- Delete (only if user has permission) -->
              {% if perms.auth.delete_user %}
                {% if user.groups.first.name == "Client" or user.groups.first.name == "Freelancer" %}
                <form action="{% url 'delete_user' user.id %}" method="post" onsubmit="return confirm('Are you sure you want to delete this user?');">
                    {% csrf_token %}
                    <button type="submit"
                    class="inline-block text-sm px-4 py-1.5 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition">
                    Delete
                    </button>
                </form>
                {% endif %}
              {% endif %}

            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="py-6 text-center text-gray-500">No users found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</main>

{% endblock %}
